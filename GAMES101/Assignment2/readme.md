## 101作业2  
123三个作业是连贯而成的 所以有些1中的功能可以移植过来    
### 必需内容 略  
### 提高内容 略  
### 个人尝试  
#### 移植上次作业中的内容  
首先是沿用上个框架的功能 虽然说是沿用 但移植的时候会遇到一些问题的  
下面主要记录一下遇到的问题和解决方法  
##### 性能问题  
原本第二次作业的帧率就堪忧 现在移动的比较近的时候帧数会更要命 个人感觉优化速度是必要的了  
采取了以下的手段：  
* 去除AA：查看了程序性能的图片发现反走样占掉了足足60%的性能 所以我暂时把这个功能去掉了 没办法cpu实在难干gpu的活   
* 优化重心计算：原来给的重心坐标计算函数非要把三个值全按一大串算出来 明明算了两个第三个就知道了的   
* O3优化：这个优化是最后在编译的时候加上的 用上之后效果相当明显 终于是有了不错的流畅度 不得不说编译器还是厉害的   

##### 程序崩溃  
在移植的过程中 有时候会出现程序崩溃的情况 并且当视角向各方向移动时画面会逐渐扭曲直至崩溃 相当迷惑  
经过一番排查发现 问题的根源在于原本的程序框架根本没有判断三角形会在屏幕之外 仍然将三角形的顶点信息传入函数 从而导致光栅化函数中使用一个太大的x或y坐标获取相应像素的信息导致崩溃    
实际操作为在三角形光栅化中将包围盒限制在屏幕内部即可    
***
#### 显示问题排除  
上次提到了三角形在背面也会被绘制的问题 不仅如此 如果按照上面的流程实现了的话 会观察到在奇怪的角度屏幕会突然绘制出一大片蓝色/绿色 也就是说三角形在某些奇怪的位置还是被绘制了  
具体而言 我们期望的绘制结果应该是 从背面观察三角形仍然正常显示 不会出现奇怪的色块 并且与相机移动的情况也相符 我们一步步看  
##### 背面反向三角形排除  
在draw函数中有将计算得到的点转为标准的齐次坐标的计算 然而这个计算很显然没有考虑背面的情况  
此处做一个判断符号即可 不多说  
##### 奇怪的色块排除  
其实奇怪的色块和上面的背面反向三角形都是一个起因 这一点我也不是很确定 但可以进行一步简单处理 在上面的背面三角形判断中限制三个点都必须在正面就不会出现类似的情况了  
不过这里提一点 按这个方法简单判断三角形在背面（也即有一个点在背面就算作背面并排除）会导致我们侧着向三角形侧面移动的时候三角形提前消失 这个问题还有待解决  
##### 正确显示背面三角形  
经过上面的fix之后 从背面观察应该就什么都看不到了 我们希望还能看到三角形 这里就需要引入一个新的三角形（当然我觉得改变一下计算逻辑也是可以的）  
一个简单的三角形是单向的 也就是说 在insideTriangle函数中我们利用叉乘判断点是否在三角形内部 然而由于我们从背面观察 导致了三次叉乘的结果都会刚好相反 从而判定为没有点与三角形相交  
实际的3D物体都是由很多面片组成的 这些面片应该包围出一个封闭的空间 对于三角形而言 我们只要在三角形列表中加入两个顶点顺序完全相反的三角形即可   